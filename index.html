<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Tracker - Login</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Font: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        /* Use Inter as the default font */
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
    <script>
        // Configure Tailwind for dark mode
        tailwind.config = {
            darkMode: 'class'
        }
    </script>
</head>
<body class="bg-slate-100 dark:bg-slate-900 flex items-center justify-center min-h-screen p-4 antialiased">

    <div class="bg-white dark:bg-slate-800 w-full max-w-md p-8 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700">
        <div class="flex flex-col items-center mb-6">
            <!-- Icon -->
            <div class="w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <h1 class="text-3xl font-bold text-slate-900 dark:text-white">Welcome Back</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-1">Please log in to your account</p>
        </div>
        
        <form id="loginForm" class="space-y-5">
            <div>
                <label for="username" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Username</label>
                <input type="text" id="username" placeholder="Enter your username" required 
                       class="w-full px-4 py-3 bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
            </div>
            
            <div>
                <label for="password" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1">Password</label>
                <input type="password" id="password" placeholder="Enter your password" required 
                       class="w-full px-4 py-3 bg-slate-100 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-lg text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
            </div>
            
            <button type="submit" 
                    class="w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 dark:focus:ring-offset-slate-800 transition-all duration-200">
                Login
            </button>
            
            <div id="errorMessage" class="text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-600 p-3 rounded-lg font-medium text-sm" style="display: none;">
                <!-- Error message will appear here -->
            </div>
        </form>
    </div>

    <script>
        // =================== APP CONFIGURATION ===================
        const APP_NAME = 'sales-tracker';

        // =================== FIREBASE CONFIGURATION ===================
        const firebaseConfig = {
            apiKey: "AIzaSyDx-OMCr0Af1cdK-hX5dL50S0YIbrbv6TE",
            authDomain: "sales-tracker-462f0.firebaseapp.com",
            databaseURL: "https://sales-tracker-462f0-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "sales-tracker-462f0",
            storageBucket: "sales-tracker-462f0.firebasestorage.app",
            messagingSenderId: "1070379275425",
            appId: "1:1070379275425:web:9642bdf4ca37c6aa850ce0"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Helper function to get app-specific database reference
        function getRef(path) {
            return database.ref(APP_NAME + '/' + path);
        }

        // =================== LOGIN LOGIC ===================
        const loginForm = document.getElementById('loginForm');
        const errorMessage = document.getElementById('errorMessage');

        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Force username to lowercase to match database key
            const username = document.getElementById('username').value.trim().toLowerCase(); 
            const password = document.getElementById('password').value;

            if (!username || !password) {
                showError('Please enter both username and password.');
                return;
            }

            // Get the user data from Firebase
            getRef('users/' + username).once('value')
                .then((snapshot) => {
                    if (snapshot.exists()) {
                        const user = snapshot.val();
                        
                        // Check if password matches
                        if (user.password === password) {
                            
                            // SUCCESS!
                            // Store the entire user object in localStorage as a string
                            localStorage.setItem('session', JSON.stringify(user));
                            
                            // Save dark mode preference if it exists, so dashboard can pick it up
                            if (document.documentElement.classList.contains('dark')) {
                                localStorage.setItem('darkMode', 'true');
                            } else {
                                localStorage.setItem('darkMode', 'false');
                            }
                            
                            // Redirect to the dashboard
                            window.location.href = 'dashboard.html'; 

                        } else {
                            // Password incorrect
                            showError('❌ Invalid username or password.');
                        }
                    } else {
                        // User not found
                        showError('❌ Invalid username or password.');
                    }
                })
                .catch((error) => {
                    showError('Database error: ' + error.message);
                });
        });

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        // Check for dark mode preference on load
        if (localStorage.getItem('darkMode') === 'true' || (!('darkMode' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>

</body>
</html>
